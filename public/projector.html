<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PPL S7 â€” Live Auction</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;600;700;800;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<script src="/socket.io/socket.io.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#060610;--green:#00e676;--gd:rgba(0,230,118,0.08);--gb:rgba(0,230,118,0.18);
  --red:#ff4757;--yellow:#ffc107;--text:#eeeef8;--td:#5555a8;
  --ff:'Barlow Condensed',sans-serif;--ffm:'DM Mono',monospace;
}
html,body{width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:var(--ff)}

/* â”€â”€â”€ IDLE SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#idleScreen{
  position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:var(--bg);z-index:20;
  background-image:
    radial-gradient(ellipse 60% 50% at 30% 50%, rgba(0,230,118,0.04) 0%, transparent 60%),
    radial-gradient(ellipse 60% 50% at 70% 50%, rgba(64,196,255,0.03) 0%, transparent 60%);
}
#idleScreen::before{
  content:'';position:absolute;inset:0;
  background-image:
    linear-gradient(rgba(0,230,118,0.025) 1px,transparent 1px),
    linear-gradient(90deg,rgba(0,230,118,0.025) 1px,transparent 1px);
  background-size:52px 52px;pointer-events:none;
}
.idle-logo{width:min(16vw,130px);height:min(16vw,130px);object-fit:contain;margin-bottom:1.5rem;animation:fadeIn 1s ease}
.idle-name{font-size:min(14vw,9rem);font-weight:900;letter-spacing:0.18em;
  color:transparent;-webkit-text-stroke:2px rgba(0,230,118,0.4);
  text-transform:uppercase;line-height:0.85;text-align:center;animation:fadeIn 1s ease}
.idle-season{font-size:min(3vw,1.6rem);font-weight:300;letter-spacing:0.55em;
  text-transform:uppercase;color:var(--td);margin-top:1rem;text-align:center;animation:fadeIn 1.2s ease}
.idle-waiting{margin-top:2.5rem;font-family:var(--ffm);font-size:min(1.2vw,0.82rem);
  letter-spacing:0.18em;color:var(--green);opacity:0.5;animation:blink 2.5s infinite}
@keyframes blink{0%,100%{opacity:0.5}50%{opacity:0.15}}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€â”€ MAIN SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/* Uses a fixed 3-column grid. Bottom strip is fixed height. Everything scales with vw/vh */
#mainScreen{
  position:fixed;inset:0;display:none;flex-direction:column;
}

/* Background glow */
.ambient{position:absolute;inset:0;pointer-events:none;z-index:0}
.ambient-img{position:absolute;inset:-30%;opacity:0.1;background-size:cover;background-position:center;filter:blur(90px) saturate(2)}

/* Top content area (fills above the strip) */
.top-area{
  flex:1;min-height:0;
  display:grid;
  grid-template-columns:38% 1fr 26%;
  position:relative;z-index:2;
}

/* Photo */
.photo-col{position:relative;overflow:hidden}
.photo-col img{width:100%;height:100%;object-fit:cover;object-position:top center;display:block}
.photo-fade-r{position:absolute;inset:0;background:linear-gradient(to right,transparent 50%,var(--bg) 100%)}
.photo-fade-b{position:absolute;bottom:0;left:0;right:0;height:40%;background:linear-gradient(to top,var(--bg),transparent)}

/* Info */
.info-col{
  display:flex;flex-direction:column;justify-content:flex-end;
  padding:min(4vh,3rem) min(3vw,2.5rem);
}
.league-corner{display:flex;align-items:center;gap:0.6rem;margin-bottom:min(3vh,2rem);opacity:0.65}
.league-corner img{width:min(5vw,48px);height:min(5vw,48px);object-fit:contain}
.league-corner span{font-size:min(1.3vw,1rem);font-weight:700;letter-spacing:0.3em;text-transform:uppercase;color:var(--td)}
.player-pos-tag{
  display:inline-block;background:var(--green);color:#000;
  padding:min(0.5vh,0.35rem) min(1vw,0.85rem);
  font-size:min(2.2vw,1.4rem);font-weight:900;letter-spacing:0.15em;text-transform:uppercase;
  margin-bottom:min(1vh,0.7rem);align-self:flex-start;
}
.player-name{
  font-size:min(9vw,7rem);font-weight:900;
  line-height:0.88;letter-spacing:0.02em;text-transform:uppercase;
  margin-bottom:min(1.5vh,1rem);
  text-shadow:0 4px 40px rgba(0,0,0,0.6);
}
.player-stats{display:flex;align-items:center;gap:min(2vw,1.5rem);margin-bottom:min(2vh,1.2rem)}
.rating-ring{
  width:min(7vw,60px);height:min(7vw,60px);
  border-radius:50%;border:2px solid var(--green);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  color:var(--green);line-height:1;flex-shrink:0;
}
.rating-ring .num{font-size:min(2.8vw,1.9rem);font-weight:900}
.rating-ring .lbl{font-size:0.35em;letter-spacing:0.1em;opacity:0.6}
.base-price{font-family:var(--ffm);font-size:min(1.2vw,0.82rem);color:var(--td);letter-spacing:0.06em}

/* Bid column */
.bid-col{
  display:flex;flex-direction:column;
  background:rgba(6,6,16,0.7);
  border-left:1px solid rgba(0,230,118,0.08);
  backdrop-filter:blur(20px);
  position:relative;overflow:hidden;
}
.bid-col::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,var(--green),transparent);
}

.bid-main{
  flex:1;display:flex;flex-direction:column;align-items:center;
  justify-content:center;padding:min(3vh,2rem) min(2vw,1.5rem);gap:min(1vh,0.6rem);
}
.bid-label{font-family:var(--ffm);font-size:min(1vw,0.68rem);letter-spacing:0.2em;text-transform:uppercase;color:var(--td)}
.bid-amount{
  font-size:min(7vw,5.5rem);font-weight:900;color:var(--green);line-height:0.9;text-align:center;
  text-shadow:0 0 30px rgba(0,230,118,0.35);
}
.bid-amount.flash{animation:bidFlash 0.45s ease}
@keyframes bidFlash{
  0%{transform:scale(1)}
  30%{transform:scale(1.08);color:#fff;text-shadow:0 0 60px var(--green)}
  100%{transform:scale(1);color:var(--green)}
}

.leader-area{display:flex;flex-direction:column;align-items:center;gap:min(0.8vh,0.5rem);margin-top:min(1vh,0.5rem)}
.leader-logo{width:min(6vw,54px);height:min(6vw,54px);object-fit:contain;border-radius:6px}
.leader-name{
  font-size:min(2.8vw,2rem);font-weight:900;letter-spacing:0.05em;
  padding:min(0.5vh,0.3rem) min(1.5vw,1rem);border-radius:4px;
  text-align:center;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
}

.next-bid-box{
  padding:min(1.2vh,0.8rem) min(2vw,1.5rem);
  border-top:1px solid rgba(255,255,255,0.05);
  text-align:center;
}
.nb-label{font-family:var(--ffm);font-size:min(0.9vw,0.62rem);letter-spacing:0.15em;text-transform:uppercase;color:var(--td);margin-bottom:0.2rem}
.nb-val{font-family:var(--ffm);font-size:min(1.8vw,1.1rem);color:rgba(0,230,118,0.55)}

/* Bid history */
.bid-hist{padding:min(1.5vh,1rem) min(2vw,1.5rem);border-top:1px solid rgba(255,255,255,0.04)}
.bh-title{font-family:var(--ffm);font-size:min(0.9vw,0.6rem);letter-spacing:0.2em;text-transform:uppercase;color:var(--td);margin-bottom:min(1vh,0.6rem)}
.bh-row{
  display:flex;align-items:center;gap:min(1vw,0.6rem);
  padding:min(0.7vh,0.4rem) 0;
  border-bottom:1px solid rgba(255,255,255,0.03);
  animation:slideIn 0.3s ease;
}
@keyframes slideIn{from{opacity:0;transform:translateX(10px)}to{opacity:1;transform:translateX(0)}}
.bh-row:last-child{border-bottom:none}
.bh-tlogo{width:min(2.2vw,18px);height:min(2.2vw,18px);object-fit:contain;border-radius:2px;flex-shrink:0}
.bh-team{font-weight:700;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:min(1.6vw,1rem)}
.bh-amt{font-family:var(--ffm);font-size:min(1.3vw,0.82rem);color:var(--green);flex-shrink:0}

/* â”€â”€â”€ TEAMS STRIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/* Fixed height strip at the bottom â€” always visible, never cut off */
#strip{
  flex-shrink:0;
  background:rgba(6,6,16,0.96);
  border-top:1px solid rgba(0,230,118,0.07);
  backdrop-filter:blur(12px);
  display:flex;
  height:min(10vh,80px);
  position:relative;z-index:10;
}
.strip-team{
  flex:1;display:flex;align-items:center;
  padding:0 min(1.5vw,1.2rem);gap:min(1vw,0.7rem);
  border-right:1px solid rgba(255,255,255,0.03);
  transition:background 0.3s;
}
.strip-team:last-child{border-right:none}
.strip-team.leading{background:rgba(0,230,118,0.04)}
.strip-logo{width:min(4.5vw,38px);height:min(4.5vw,38px);object-fit:contain;border-radius:4px;flex-shrink:0}
.strip-info{flex:1;min-width:0}
.strip-name{font-size:min(1.8vw,1.15rem);font-weight:800;letter-spacing:0.04em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.strip-count{font-family:var(--ffm);font-size:min(0.9vw,0.6rem);color:var(--td);letter-spacing:0.06em;margin-top:0.1rem}
.strip-budget{text-align:right;flex-shrink:0}
.strip-bnum{font-size:min(2.2vw,1.4rem);font-weight:900;color:var(--green)}
.strip-blbl{font-family:var(--ffm);font-size:min(0.8vw,0.52rem);letter-spacing:0.06em;color:var(--td);text-transform:uppercase}

/* â”€â”€â”€ RESULT OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#resultOverlay{
  position:fixed;inset:0;z-index:50;display:none;
  align-items:center;justify-content:center;flex-direction:column;gap:1.2rem;
  background:rgba(0,0,0,0.88);backdrop-filter:blur(18px);
}
.result-word{
  font-size:min(20vw,14rem);font-weight:900;letter-spacing:0.08em;line-height:1;text-align:center;
}
.result-word.sold{color:var(--green);text-shadow:0 0 100px rgba(0,230,118,0.7);animation:soldPop 0.5s cubic-bezier(0.34,1.56,0.64,1)}
.result-word.unsold{color:var(--red);text-shadow:0 0 80px rgba(255,71,87,0.6);animation:soldPop 0.5s ease}
@keyframes soldPop{from{transform:scale(0.4);opacity:0}to{transform:scale(1);opacity:1}}
.result-player{font-size:min(5vw,3.5rem);font-weight:700;letter-spacing:0.06em;color:var(--text)}
.result-team-row{display:flex;align-items:center;gap:min(2vw,1.2rem);margin-top:0.5rem}
.result-team-logo{width:min(8vw,70px);height:min(8vw,70px);object-fit:contain;border-radius:6px}
.result-team-name{font-size:min(4vw,3rem);font-weight:900;letter-spacing:0.06em}
.result-price{font-family:var(--ffm);font-size:min(2.5vw,1.8rem);color:var(--green);letter-spacing:0.05em}
</style>
</head>
<body>

<!-- IDLE -->
<div id="idleScreen">
  <img class="idle-logo" id="idleLogo" src="" alt="" style="display:none"/>
  <div class="idle-name" id="idleName">PPL</div>
  <div class="idle-season" id="idleSeason">Premier Player League Â· Season 7</div>
  <div class="idle-waiting">âš½ &nbsp; AUCTION BEGINS SHORTLY &nbsp; âš½</div>
</div>

<!-- MAIN -->
<div id="mainScreen">
  <div class="ambient"><div class="ambient-img" id="ambientImg"></div></div>

  <div class="top-area">
    <!-- PHOTO -->
    <div class="photo-col">
      <img id="pPhoto" src="" alt=""/>
      <div class="photo-fade-r"></div>
      <div class="photo-fade-b"></div>
    </div>

    <!-- INFO -->
    <div class="info-col">
      <div class="league-corner" id="leagueCorner" style="display:none">
        <img id="leagueCornerImg" src="" alt=""/>
        <span id="leagueCornerText"></span>
      </div>
      <div class="player-pos-tag" id="pPos"></div>
      <div class="player-name" id="pName"></div>
      <div class="player-stats">
        <div class="rating-ring"><span class="num" id="pRating"></span><span class="lbl">OVR</span></div>
        <div class="base-price" id="pBase"></div>
      </div>
    </div>

    <!-- BID PANEL -->
    <div class="bid-col">
      <div class="bid-main">
        <div class="bid-label">Current Bid</div>
        <div class="bid-amount" id="bidAmount">â‚¹0</div>
        <div class="leader-area">
          <img class="leader-logo" id="leaderLogo" src="" alt="" style="display:none"/>
          <div class="leader-name" id="leaderName" style="background:#1a1a2e;color:#4444aa">No bids yet</div>
        </div>
      </div>

      <div class="next-bid-box">
        <div class="nb-label">Next bid</div>
        <div class="nb-val" id="nextBidVal">â€”</div>
      </div>

      <div class="bid-hist">
        <div class="bh-title">Bid History</div>
        <div id="bidHist"></div>
      </div>
    </div>
  </div>

  <!-- TEAMS STRIP -->
  <div id="strip"></div>
</div>

<!-- RESULT OVERLAY -->
<div id="resultOverlay">
  <div class="result-word" id="resultWord"></div>
  <div class="result-player" id="resultPlayer"></div>
  <div class="result-team-row" id="resultTeamRow" style="display:none">
    <img class="result-team-logo" id="resultTeamLogo" src="" alt=""/>
    <div class="result-team-name" id="resultTeamName"></div>
  </div>
  <div class="result-price" id="resultPrice"></div>
</div>

<script>
const socket = io();
let S = { auctionState:{phase:'idle',currentBid:0}, teams:[], players:[], config:{} };

socket.on('stateUpdate', data => { S=data; render(); });
socket.on('bidFlash', () => {
  const el = document.getElementById('bidAmount');
  el.classList.remove('flash'); void el.offsetWidth; el.classList.add('flash');
});
socket.on('playerSold',  ({player,team,price}) => showResult('SOLD!','sold',player,team,`â‚¹${price.toLocaleString()}`,5000));
socket.on('playerUnsold',({player})             => showResult('UNSOLD','unsold',player,null,'',3500));

function render() {
  const { auctionState:as, teams, config } = S;
  renderIdle(config);
  renderStrip(as, teams);

  if (!as.currentPlayer || as.phase==='idle') {
    document.getElementById('idleScreen').style.display = 'flex';
    document.getElementById('mainScreen').style.display = 'none';
    return;
  }
  document.getElementById('idleScreen').style.display = 'none';
  document.getElementById('mainScreen').style.display = 'flex';
  renderPlayer(as, config);
}

function renderIdle(cfg) {
  const logo = document.getElementById('idleLogo');
  if (cfg.leagueLogo) { logo.src=cfg.leagueLogo; logo.style.display='block'; } else logo.style.display='none';
  document.getElementById('idleName').textContent   = cfg.leagueName||'PPL';
  document.getElementById('idleSeason').textContent = `${cfg.leagueName||'PPL'} Â· ${cfg.leagueSeason||'Season 7'}`;
}

function renderPlayer(as, config) {
  const { currentPlayer:p, currentBid, leadingTeam, bidHistory } = as;

  document.getElementById('pPhoto').src = p.photo;
  document.getElementById('ambientImg').style.backgroundImage = `url(${p.photo})`;
  document.getElementById('pPos').textContent    = p.position;
  document.getElementById('pName').textContent   = p.name;
  document.getElementById('pRating').textContent = p.rating;
  document.getElementById('pBase').textContent   = `BASE  â‚¹${p.basePrice.toLocaleString()}`;
  document.getElementById('bidAmount').textContent= `â‚¹${currentBid.toLocaleString()}`;

  // League corner
  const corner = document.getElementById('leagueCorner');
  if (config.leagueLogo) {
    document.getElementById('leagueCornerImg').src  = config.leagueLogo;
    document.getElementById('leagueCornerText').textContent = config.leagueSeason||'';
    corner.style.display = 'flex';
  } else corner.style.display = 'none';

  // Leader
  const ldrName = document.getElementById('leaderName');
  const ldrLogo = document.getElementById('leaderLogo');
  if (leadingTeam) {
    ldrName.textContent      = leadingTeam.name;
    ldrName.style.background = leadingTeam.color;
    ldrName.style.color      = '#000';
    if (leadingTeam.logo) { ldrLogo.src=leadingTeam.logo; ldrLogo.style.display='block'; } else ldrLogo.style.display='none';
  } else {
    ldrName.textContent='No bids yet'; ldrName.style.background='#1a1a2e'; ldrName.style.color='#4444aa';
    ldrLogo.style.display='none';
  }

  // Next bid
  const cfg  = config;
  const inc  = currentBid < (cfg.thresholdBid??200) ? (cfg.highIncrement??20) : (cfg.lowIncrement??10);
  document.getElementById('nextBidVal').textContent = `â‚¹${(currentBid+inc).toLocaleString()}  (+â‚¹${inc})`;

  // Bid history
  const bh = document.getElementById('bidHist');
  bh.innerHTML = (bidHistory||[]).slice(0,5).map((b,i) => `
    <div class="bh-row">
      ${b.logo?`<img class="bh-tlogo" src="${b.logo}" alt=""/>`:`<div class="bh-tlogo" style="border-radius:50%;background:${b.color};opacity:0.4"></div>`}
      <span class="bh-team" style="color:${b.color}">${i===0?'ğŸ† ':''}${b.team}</span>
      <span class="bh-amt">â‚¹${b.amount.toLocaleString()}</span>
    </div>`).join('');
}

function renderStrip(as, teams) {
  document.getElementById('strip').innerHTML = teams.map(t => {
    const rem       = t.budget - t.spent;
    const isLeading = as.leadingTeam?.id === t.id;
    return `<div class="strip-team ${isLeading?'leading':''}">
      ${t.logo
        ? `<img class="strip-logo" src="${t.logo}" alt=""/>`
        : `<div class="strip-logo" style="border-radius:50%;background:${t.color};opacity:${isLeading?0.5:0.2}"></div>`}
      <div class="strip-info">
        <div class="strip-name" style="color:${t.color};${isLeading?'text-shadow:0 0 12px '+t.color+'99;':''}">${t.name}</div>
        <div class="strip-count">${t.players.length} player${t.players.length!==1?'s':''}</div>
      </div>
      <div class="strip-budget">
        <div class="strip-bnum" style="${isLeading?'color:'+t.color:''}">${isLeading?'â¬† ':''}â‚¹${rem.toLocaleString()}</div>
        <div class="strip-blbl">Remaining</div>
      </div>
    </div>`;
  }).join('');
}

function showResult(word, type, player, team, price, dur) {
  const ov = document.getElementById('resultOverlay');
  document.getElementById('resultWord').textContent  = word;
  document.getElementById('resultWord').className    = `result-word ${type}`;
  document.getElementById('resultPlayer').textContent= player.name;
  document.getElementById('resultPrice').textContent = price;
  const tr = document.getElementById('resultTeamRow');
  if (team) {
    document.getElementById('resultTeamName').textContent = team.name;
    document.getElementById('resultTeamName').style.color = team.color;
    const tl = document.getElementById('resultTeamLogo');
    if (team.logo) { tl.src=team.logo; tl.style.display='block'; } else tl.style.display='none';
    tr.style.display='flex';
  } else tr.style.display='none';
  ov.style.display='flex';
  setTimeout(()=>ov.style.display='none', dur);
}

render();
</script>
</body>
</html>
