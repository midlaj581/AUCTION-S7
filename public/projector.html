<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PPL S7 â€” Live Auction</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;600;700;800;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<script src="/socket.io/socket.io.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#060610;--green:#00e676;--red:#ff4757;--yellow:#ffc107;
  --text:#eeeef8;--td:#5555a8;
  --ff:'Barlow Condensed',sans-serif;--ffm:'DM Mono',monospace;
}
html,body{width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:var(--ff)}

/* â”€â”€â”€ IDLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#idleScreen{
  position:fixed;inset:0;z-index:20;display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  background:var(--bg);
  background-image:
    radial-gradient(ellipse 55% 45% at 30% 50%,rgba(0,230,118,0.05) 0%,transparent 60%),
    radial-gradient(ellipse 55% 45% at 70% 50%,rgba(64,196,255,0.04) 0%,transparent 60%),
    linear-gradient(rgba(0,230,118,0.025) 1px,transparent 1px),
    linear-gradient(90deg,rgba(0,230,118,0.025) 1px,transparent 1px);
  background-size:100% 100%,100% 100%,52px 52px,52px 52px;
}
.idle-logo{width:min(15vw,130px);height:min(15vw,130px);object-fit:contain;margin-bottom:1.5rem}
.idle-name{font-size:min(13vw,9rem);font-weight:900;letter-spacing:0.2em;
  color:transparent;-webkit-text-stroke:2px rgba(0,230,118,0.42);
  text-transform:uppercase;line-height:0.85;text-align:center}
.idle-season{font-size:min(2.8vw,1.6rem);font-weight:300;letter-spacing:0.5em;
  text-transform:uppercase;color:var(--td);margin-top:1rem;text-align:center}
.idle-dot{margin-top:2.5rem;font-family:var(--ffm);font-size:min(1.1vw,0.78rem);
  letter-spacing:0.18em;color:var(--green);opacity:0.45;animation:blink 2.5s infinite}
@keyframes blink{0%,100%{opacity:0.45}50%{opacity:0.12}}

/* â”€â”€â”€ MAIN SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#mainScreen{
  position:fixed;inset:0;display:none;flex-direction:column;
}

/* 3-column layout fills remaining height above strip */
.main-area{
  flex:1;min-height:0;
  display:grid;
  /* Photo | Bid Center | Details+bg */
  grid-template-columns:30% 38% 1fr;
  position:relative;
}

/* â”€â”€ COLUMN 1: PHOTO â”€â”€ */
.col-photo{position:relative;overflow:hidden}
.col-photo img.player-img{
  width:100%;height:100%;object-fit:cover;
  object-position:top center;display:block;
}
/* Fade right edge into bg */
.col-photo::after{
  content:'';position:absolute;inset:0;
  background:linear-gradient(to right,transparent 60%,var(--bg) 100%);
}

/* â”€â”€ COLUMN 2: BID CENTER â”€â”€ */
.col-bid{
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  gap:min(2vh,1.2rem);
  padding:min(4vh,2.5rem) min(2vw,1.5rem);
  position:relative;z-index:2;
  /* Subtle center glow */
  background:radial-gradient(ellipse 80% 60% at 50% 50%,rgba(0,230,118,0.04) 0%,transparent 70%);
}

.bid-lbl{
  font-family:var(--ffm);font-size:min(1.1vw,0.82rem);
  letter-spacing:0.25em;text-transform:uppercase;color:var(--td);
}
.bid-amount{
  font-size:min(12vw,9rem);font-weight:900;color:var(--green);
  line-height:0.85;text-align:center;
  text-shadow:0 0 40px rgba(0,230,118,0.5),0 0 80px rgba(0,230,118,0.2);
  transition:color 0.15s;
}
.bid-amount.flash{animation:bidFlash 0.5s ease}
@keyframes bidFlash{
  0%{transform:scale(1)}
  25%{transform:scale(1.08);color:#fff;text-shadow:0 0 80px var(--green),0 0 160px rgba(0,230,118,0.4)}
  100%{transform:scale(1);color:var(--green)}
}

/* Leader block */
.leader-block{display:flex;flex-direction:column;align-items:center;gap:min(0.8vh,0.5rem);margin-top:min(0.5vh,0.3rem)}
.leader-logo{width:min(6vw,58px);height:min(6vw,58px);object-fit:contain;border-radius:6px}
.leader-name{
  font-size:min(3.2vw,2.2rem);font-weight:900;letter-spacing:0.05em;
  padding:min(0.5vh,0.35rem) min(1.5vw,1.1rem);border-radius:5px;
  max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
}

/* Divider line */
.bid-divider{width:50%;height:1px;background:linear-gradient(to right,transparent,rgba(0,230,118,0.3),transparent);margin:min(0.5vh,0.3rem) 0}

/* Next bid & history */
.next-row{font-family:var(--ffm);font-size:min(1.2vw,0.82rem);color:rgba(0,230,118,0.4);text-align:center}
.bid-hist{width:100%;display:flex;flex-direction:column;gap:min(0.8vh,0.45rem);max-width:95%}
.bh-row{
  display:flex;align-items:center;gap:0.5rem;
  padding:min(0.6vh,0.38rem) min(1vw,0.65rem);
  background:rgba(255,255,255,0.03);border-radius:4px;
  animation:slideIn 0.3s ease;
}
@keyframes slideIn{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:translateX(0)}}
.bh-tlogo{width:min(2vw,16px);height:min(2vw,16px);object-fit:contain;border-radius:2px;flex-shrink:0}
.bh-team{font-weight:700;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:min(1.5vw,0.95rem)}
.bh-amt{font-family:var(--ffm);font-size:min(1.2vw,0.78rem);color:var(--green);flex-shrink:0}

/* â”€â”€ COLUMN 3: PLAYER DETAILS (with blurred image bg) â”€â”€ */
.col-details{
  position:relative;overflow:hidden;
  display:flex;flex-direction:column;justify-content:flex-end;
}

/* Blurred image background fills this column */
.details-bg{
  position:absolute;inset:-20%;
  background-size:cover;background-position:top center;
  filter:blur(35px) saturate(1.4) brightness(0.35);
  transition:background-image 0.8s;
}
/* Dark gradient overlay so text is readable */
.details-overlay{
  position:absolute;inset:0;
  background:
    linear-gradient(to right, rgba(6,6,16,0.5) 0%, rgba(6,6,16,0.05) 100%),
    linear-gradient(to top, rgba(6,6,16,0.9) 0%, rgba(6,6,16,0.1) 50%, transparent 100%);
}

/* The actual content */
.details-content{
  position:relative;z-index:2;
  padding:min(4vh,3rem) min(3vw,2.5rem);
  display:flex;flex-direction:column;gap:min(1vh,0.6rem);
}

/* League corner badge */
.league-badge{display:flex;align-items:center;gap:0.6rem;margin-bottom:min(2vh,1.5rem);opacity:0.7}
.league-badge img{width:min(4.5vw,40px);height:min(4.5vw,40px);object-fit:contain}
.league-badge span{font-size:min(1.2vw,0.85rem);font-weight:700;letter-spacing:0.3em;text-transform:uppercase;color:var(--td)}

.detail-pos{
  display:inline-block;align-self:flex-start;
  background:var(--green);color:#000;
  padding:min(0.4vh,0.28rem) min(0.9vw,0.7rem);
  font-size:min(2vw,1.2rem);font-weight:900;letter-spacing:0.15em;text-transform:uppercase;
  margin-bottom:min(0.5vh,0.3rem);border-radius:3px;
}
.detail-name{
  font-size:min(5.5vw,4.5rem);font-weight:900;
  line-height:0.88;letter-spacing:0.02em;text-transform:uppercase;
  text-shadow:0 2px 20px rgba(0,0,0,0.8);
}
.detail-rating-row{display:flex;align-items:center;gap:min(1.5vw,1rem);margin-top:min(1vh,0.6rem)}
.rating-ring{
  width:min(5.5vw,52px);height:min(5.5vw,52px);
  border-radius:50%;border:2px solid var(--green);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  color:var(--green);line-height:1;flex-shrink:0;
}
.rating-ring .num{font-size:min(2.2vw,1.6rem);font-weight:900}
.rating-ring .lbl{font-size:0.35em;letter-spacing:0.1em;opacity:0.6}
.detail-meta{font-family:var(--ffm);font-size:min(1.1vw,0.75rem);color:rgba(255,255,255,0.45);letter-spacing:0.06em}

/* â”€â”€ TEAMS STRIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#strip{
  flex-shrink:0;
  background:rgba(6,6,16,0.97);border-top:1px solid rgba(0,230,118,0.07);
  display:flex;height:min(10vh,78px);
  position:relative;z-index:10;
}
.strip-team{
  flex:1;display:flex;align-items:center;
  padding:0 min(1.5vw,1.2rem);gap:min(0.9vw,0.65rem);
  border-right:1px solid rgba(255,255,255,0.03);
  transition:background 0.3s;
}
.strip-team:last-child{border-right:none}
.strip-team.leading{background:rgba(0,230,118,0.05)}
.s-logo{width:min(4vw,36px);height:min(4vw,36px);object-fit:contain;border-radius:4px;flex-shrink:0}
.s-info{flex:1;min-width:0}
.s-name{font-size:min(1.8vw,1.1rem);font-weight:800;letter-spacing:0.04em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.s-count{font-family:var(--ffm);font-size:min(0.85vw,0.58rem);color:var(--td);margin-top:0.1rem}
.s-budget{text-align:right;flex-shrink:0}
.s-bnum{font-size:min(2.2vw,1.4rem);font-weight:900;color:var(--green)}
.s-blbl{font-family:var(--ffm);font-size:min(0.7vw,0.5rem);letter-spacing:0.06em;color:var(--td);text-transform:uppercase}

/* â”€â”€ SOLD / UNSOLD OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#resultOverlay{
  position:fixed;inset:0;z-index:50;display:none;
  align-items:center;justify-content:center;flex-direction:column;gap:min(2vh,1.2rem);
  background:rgba(0,0,0,0.9);backdrop-filter:blur(20px);
}
.r-word{
  font-size:min(22vw,16rem);font-weight:900;letter-spacing:0.08em;line-height:1;text-align:center;
}
.r-word.sold{color:var(--green);text-shadow:0 0 120px rgba(0,230,118,0.7);animation:pop 0.55s cubic-bezier(0.34,1.56,0.64,1)}
.r-word.unsold{color:var(--red);text-shadow:0 0 100px rgba(255,71,87,0.6);animation:pop 0.4s ease}
@keyframes pop{from{transform:scale(0.35);opacity:0}to{transform:scale(1);opacity:1}}
.r-player{font-size:min(5vw,3.8rem);font-weight:700;letter-spacing:0.06em;color:var(--text)}
.r-team-row{display:flex;align-items:center;gap:min(2vw,1.2rem);margin-top:0.4rem}
.r-tlogo{width:min(8vw,72px);height:min(8vw,72px);object-fit:contain;border-radius:6px}
.r-tname{font-size:min(4vw,3rem);font-weight:900;letter-spacing:0.05em}
.r-price{font-family:var(--ffm);font-size:min(2.5vw,1.8rem);color:var(--green);letter-spacing:0.05em}
</style>
</head>
<body>

<!-- IDLE SCREEN -->
<div id="idleScreen">
  <img class="idle-logo" id="idleLogo" src="" alt="" style="display:none"/>
  <div class="idle-name" id="idleName">PPL</div>
  <div class="idle-season" id="idleSeason">Premier Player League Â· Season 7</div>
  <div class="idle-dot">âš½ &nbsp; AUCTION BEGINS SHORTLY &nbsp; âš½</div>
</div>

<!-- MAIN SCREEN -->
<div id="mainScreen">
  <div class="main-area">

    <!-- COLUMN 1: PHOTO -->
    <div class="col-photo">
      <img class="player-img" id="pPhoto" src="" alt=""/>
    </div>

    <!-- COLUMN 2: BID CENTER -->
    <div class="col-bid">
      <div class="bid-lbl">Current Bid</div>
      <div class="bid-amount" id="bidAmount">â‚¹0</div>

      <div class="leader-block">
        <img class="leader-logo" id="leaderLogo" src="" alt="" style="display:none"/>
        <div class="leader-name" id="leaderName" style="background:#1a1a2e;color:#3333aa">No bids yet</div>
      </div>

      <div class="bid-divider"></div>

      <div class="next-row" id="nextRow">â€”</div>

      <div class="bid-hist" id="bidHist"></div>
    </div>

    <!-- COLUMN 3: PLAYER DETAILS + blurred bg -->
    <div class="col-details">
      <div class="details-bg" id="detailsBg"></div>
      <div class="details-overlay"></div>
      <div class="details-content">
        <div class="league-badge" id="leagueBadge" style="display:none">
          <img id="leagueBadgeImg" src="" alt=""/>
          <span id="leagueBadgeTxt"></span>
        </div>
        <div class="detail-pos" id="dPos"></div>
        <div class="detail-name" id="dName"></div>
        <div class="detail-rating-row">
          <div class="rating-ring"><span class="num" id="dRating"></span><span class="lbl">OVR</span></div>
          <div class="detail-meta" id="dMeta"></div>
        </div>
      </div>
    </div>

  </div><!-- /main-area -->

  <!-- TEAMS STRIP -->
  <div id="strip"></div>
</div>

<!-- RESULT OVERLAY -->
<div id="resultOverlay">
  <div class="r-word" id="rWord"></div>
  <div class="r-player" id="rPlayer"></div>
  <div class="r-team-row" id="rTeamRow" style="display:none">
    <img class="r-tlogo" id="rTLogo" src="" alt=""/>
    <div class="r-tname" id="rTName"></div>
  </div>
  <div class="r-price" id="rPrice"></div>
</div>

<script>
const socket = io();
let S = { auctionState:{phase:'idle',currentBid:0}, teams:[], players:[], config:{} };

socket.on('stateUpdate', data => { S=data; render(); });
socket.on('bidFlash', () => {
  const el = document.getElementById('bidAmount');
  el.classList.remove('flash'); void el.offsetWidth; el.classList.add('flash');
});
socket.on('playerSold',  ({player,team,price}) => showResult('SOLD!','sold',player,team,`â‚¹${price.toLocaleString()}`,5500));
socket.on('playerUnsold',({player})             => showResult('UNSOLD','unsold',player,null,'',3500));

function render() {
  const { auctionState:as, teams, config } = S;
  renderIdle(config);
  renderStrip(as, teams);

  if (!as.currentPlayer || as.phase==='idle') {
    document.getElementById('idleScreen').style.display='flex';
    document.getElementById('mainScreen').style.display='none';
    return;
  }
  document.getElementById('idleScreen').style.display='none';
  document.getElementById('mainScreen').style.display='flex';
  renderLive(as, config);
}

function renderIdle(cfg) {
  const logo = document.getElementById('idleLogo');
  if (cfg.leagueLogo) { logo.src=cfg.leagueLogo; logo.style.display='block'; } else logo.style.display='none';
  document.getElementById('idleName').textContent   = cfg.leagueName||'PPL';
  document.getElementById('idleSeason').textContent = `${cfg.leagueName||'PPL'} Â· ${cfg.leagueSeason||'Season 7'}`;
}

function renderLive(as, config) {
  const { currentPlayer:p, currentBid, leadingTeam, bidHistory } = as;

  // PHOTO column
  document.getElementById('pPhoto').src = p.photo;

  // BID CENTER
  document.getElementById('bidAmount').textContent = `â‚¹${currentBid.toLocaleString()}`;

  const ldrName = document.getElementById('leaderName');
  const ldrLogo = document.getElementById('leaderLogo');
  if (leadingTeam) {
    ldrName.textContent = leadingTeam.name;
    ldrName.style.background = leadingTeam.color;
    ldrName.style.color = '#000';
    if (leadingTeam.logo) { ldrLogo.src=leadingTeam.logo; ldrLogo.style.display='block'; }
    else ldrLogo.style.display='none';
  } else {
    ldrName.textContent='No bids yet'; ldrName.style.background='#1a1a2e'; ldrName.style.color='#3333aa';
    ldrLogo.style.display='none';
  }

  const inc = currentBid < (config.thresholdBid??200) ? (config.highIncrement??20) : (config.lowIncrement??10);
  document.getElementById('nextRow').textContent = `Next bid: â‚¹${(currentBid+inc).toLocaleString()}  (+â‚¹${inc})`;

  // Bid history
  document.getElementById('bidHist').innerHTML = (bidHistory||[]).slice(0,5).map((b,i) => `
    <div class="bh-row">
      ${b.logo
        ? `<img class="bh-tlogo" src="${b.logo}" alt=""/>`
        : `<div class="bh-tlogo" style="border-radius:50%;background:${b.color};opacity:0.5"></div>`}
      <span class="bh-team" style="color:${b.color}">${i===0?'ğŸ† ':''}${b.team}</span>
      <span class="bh-amt">â‚¹${b.amount.toLocaleString()}</span>
    </div>`).join('');

  // DETAILS column â€” blurred image background + player info
  document.getElementById('detailsBg').style.backgroundImage = `url(${p.photo})`;
  document.getElementById('dPos').textContent    = p.position;
  document.getElementById('dName').textContent   = p.name;
  document.getElementById('dRating').textContent = p.rating;
  document.getElementById('dMeta').textContent   = `BASE PRICE  â‚¹${p.basePrice.toLocaleString()}`;

  // League badge
  const badge = document.getElementById('leagueBadge');
  if (config.leagueLogo) {
    document.getElementById('leagueBadgeImg').src  = config.leagueLogo;
    document.getElementById('leagueBadgeTxt').textContent = config.leagueSeason||'';
    badge.style.display = 'flex';
  } else badge.style.display = 'none';
}

function renderStrip(as, teams) {
  document.getElementById('strip').innerHTML = teams.map(t => {
    const rem       = t.budget - t.spent;
    const isLeading = as.leadingTeam?.id === t.id;
    return `<div class="strip-team ${isLeading?'leading':''}">
      ${t.logo
        ? `<img class="s-logo" src="${t.logo}" alt=""/>`
        : `<div class="s-logo" style="border-radius:50%;background:${t.color};opacity:${isLeading?0.6:0.2}"></div>`}
      <div class="s-info">
        <div class="s-name" style="color:${t.color};${isLeading?'text-shadow:0 0 12px '+t.color+'88;':''}">${t.name}</div>
        <div class="s-count">${t.players.length} player${t.players.length!==1?'s':''}</div>
      </div>
      <div class="s-budget">
        <div class="s-bnum" style="${isLeading?'color:'+t.color:''}">${isLeading?'â¬† ':''}â‚¹${rem.toLocaleString()}</div>
        <div class="s-blbl">Remaining</div>
      </div>
    </div>`;
  }).join('');
}

function showResult(word, type, player, team, price, dur) {
  const ov = document.getElementById('resultOverlay');
  document.getElementById('rWord').textContent   = word;
  document.getElementById('rWord').className     = `r-word ${type}`;
  document.getElementById('rPlayer').textContent = player.name;
  document.getElementById('rPrice').textContent  = price;
  const tr = document.getElementById('rTeamRow');
  if (team) {
    document.getElementById('rTName').textContent = team.name;
    document.getElementById('rTName').style.color = team.color;
    const tl = document.getElementById('rTLogo');
    if (team.logo) { tl.src=team.logo; tl.style.display='block'; } else tl.style.display='none';
    tr.style.display='flex';
  } else tr.style.display='none';
  ov.style.display='flex';
  setTimeout(() => ov.style.display='none', dur);
}

render();
</script>
</body>
</html>
