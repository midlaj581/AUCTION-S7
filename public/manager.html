<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PPL S7 â€” Manager View</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;600;700;800;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<script src="/socket.io/socket.io.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#060610;--bg2:#0b0b1a;--bg3:#101020;--bg4:#181830;--card:#1a1a2e;--border:#252545;
  --green:#00e676;--gd:rgba(0,230,118,0.08);--gb:rgba(0,230,118,0.18);--glow:rgba(0,230,118,0.3);
  --red:#ff4757;--yellow:#ffc107;
  --text:#eeeef8;--td:#7070a0;--tm:#333358;
  --ff:'Barlow Condensed',sans-serif;--ffm:'DM Mono',monospace;
  --r:6px;
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:var(--ff);font-size:15px;min-height:100vh}

/* â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#loginScreen{
  min-height:100vh;display:flex;align-items:center;justify-content:center;
  background:radial-gradient(ellipse 60% 60% at 50% 35%,rgba(0,230,118,0.05) 0%,transparent 65%);
}
.lbox{background:var(--card);border:1px solid var(--gb);border-radius:14px;padding:2.5rem;width:90%;max-width:420px;text-align:center;box-shadow:0 20px 80px rgba(0,0,0,0.5)}
.l-logo{width:68px;height:68px;object-fit:contain;margin-bottom:0.7rem;display:none}
.l-title{font-size:2.8rem;font-weight:900;letter-spacing:0.2em;color:var(--green);margin-bottom:0.15rem}
.l-sub{font-family:var(--ffm);font-size:0.6rem;letter-spacing:0.2em;color:var(--td);text-transform:uppercase;margin-bottom:2rem}
.l-label{font-family:var(--ffm);font-size:0.58rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--td);display:block;text-align:left;margin-bottom:0.55rem}
.team-btns{display:flex;flex-direction:column;gap:0.48rem;margin-bottom:1rem}
.tbtn{
  display:flex;align-items:center;gap:0.75rem;padding:0.78rem 0.95rem;
  background:var(--bg3);border:2px solid transparent;border-radius:var(--r);
  cursor:pointer;text-align:left;transition:all 0.15s;
}
.tbtn:hover{border-color:var(--gb);background:var(--bg4)}
.tbtn.sel{border-color:var(--green);background:var(--gd)}
.tbtn-logo{width:36px;height:36px;object-fit:contain;border-radius:4px;flex-shrink:0;background:var(--bg4)}
.tbtn-name{font-size:1.08rem;font-weight:800;letter-spacing:0.04em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.tbtn-meta{font-family:var(--ffm);font-size:0.58rem;color:var(--td);margin-top:0.1rem}
.enter-btn{
  width:100%;padding:0.82rem;background:var(--green);border:none;border-radius:var(--r);
  color:#000;font-family:var(--ff);font-size:1.1rem;font-weight:800;
  letter-spacing:0.1em;text-transform:uppercase;cursor:pointer;transition:all 0.15s;
}
.enter-btn:hover{background:#33ffaa;box-shadow:0 0 20px var(--glow)}
.enter-btn:disabled{opacity:0.3;cursor:not-allowed}

/* â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#appScreen{display:none;min-height:100vh;flex-direction:column}

/* Topbar */
.topbar{background:var(--bg2);border-bottom:1px solid var(--border);height:56px;padding:0 1.2rem;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.tb-l{display:flex;align-items:center;gap:0.7rem}
.tb-team-logo{width:36px;height:36px;object-fit:contain;border-radius:4px}
.tb-name{font-size:1.18rem;font-weight:800;letter-spacing:0.06em}
.phase-dot{padding:0.18rem 0.6rem;border-radius:10px;font-family:var(--ffm);font-size:0.56rem;letter-spacing:0.06em;border:1px solid;text-transform:uppercase}
.pd-idle{border-color:var(--tm);color:var(--tm)}
.pd-live{border-color:var(--green);color:var(--green);background:var(--gd);animation:gp 2s infinite}
.pd-sold{border-color:var(--yellow);color:var(--yellow)}
.pd-unsold{border-color:var(--red);color:var(--red)}
@keyframes gp{0%,100%{box-shadow:none}50%{box-shadow:0 0 8px var(--glow)}}
.tb-r{text-align:right}
.tb-budget{font-size:1.4rem;font-weight:800;color:var(--green)}
.tb-blbl{font-family:var(--ffm);font-size:0.52rem;color:var(--td);letter-spacing:0.06em;text-transform:uppercase}

/* Tabs */
.tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--border)}
.tab{flex:1;padding:0.62rem;text-align:center;cursor:pointer;font-size:0.9rem;font-weight:700;letter-spacing:0.06em;color:var(--td);border-bottom:2px solid transparent;transition:all 0.15s}
.tab.active{color:var(--green);border-bottom-color:var(--green)}
.tab:hover:not(.active){color:var(--text)}
.tc{display:none}
.tc.active{display:block}

/* Section */
.sec{padding:1rem 1.2rem}
.sh{display:flex;align-items:center;justify-content:space-between;margin-bottom:0.75rem}
.st{font-family:var(--ffm);font-size:0.6rem;letter-spacing:0.18em;text-transform:uppercase;color:var(--td)}
.sb{font-family:var(--ffm);font-size:0.6rem}

/* â”€â”€ LIVE TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/* Current player card - full bleed with image bg */
.live-card{
  margin:1rem 1.2rem;
  border-radius:var(--r);overflow:hidden;position:relative;
  border:1px solid var(--gb);min-height:200px;
}
.live-card-bg{
  position:absolute;inset:-15%;
  background-size:cover;background-position:top center;
  filter:blur(30px) saturate(1.3) brightness(0.28);
}
.live-card-overlay{
  position:absolute;inset:0;
  background:linear-gradient(to bottom,rgba(6,6,16,0.3) 0%,rgba(6,6,16,0.85) 100%);
}
.live-card-content{position:relative;z-index:2;display:grid;grid-template-columns:130px 1fr;min-height:200px}
.lc-photo{overflow:hidden}
.lc-photo img{width:100%;height:100%;object-fit:cover;object-position:top;display:block}
.lc-body{padding:1.1rem;display:flex;flex-direction:column;justify-content:space-between}
.lc-pos{display:inline-block;padding:0.18rem 0.55rem;background:var(--green);color:#000;font-weight:900;font-size:0.85rem;letter-spacing:0.1em;border-radius:3px;margin-bottom:0.4rem;align-self:flex-start}
.lc-name{font-size:1.7rem;font-weight:900;letter-spacing:0.03em;line-height:1;margin-bottom:0.2rem}
.lc-meta{font-family:var(--ffm);font-size:0.6rem;color:rgba(255,255,255,0.5);margin-bottom:0.8rem}
.lc-bid-row{display:flex;align-items:flex-end;gap:0.9rem}
.lc-bid-lbl{font-family:var(--ffm);font-size:0.56rem;text-transform:uppercase;letter-spacing:0.1em;color:rgba(255,255,255,0.4);display:block;margin-bottom:0.1rem}
.lc-bid-amt{font-size:2.2rem;font-weight:900;color:var(--green);line-height:1}
.lc-leader{display:flex;align-items:center;gap:0.35rem;padding:0.25rem 0.62rem;border-radius:3px;font-size:0.85rem;font-weight:700;color:#000;margin-top:0.15rem}
.lc-leader img{width:15px;height:15px;object-fit:contain;border-radius:2px}
.live-idle{padding:2.5rem;text-align:center;color:var(--td);font-style:italic;font-size:0.95rem;position:relative;z-index:2}
.leading-banner{position:absolute;top:0;right:0;background:var(--green);color:#000;padding:0.2rem 0.75rem;font-size:0.78rem;font-weight:800;letter-spacing:0.1em;text-transform:uppercase;border-radius:0 var(--r) 0 4px;z-index:3}

/* Bid history in live tab */
.live-hist{margin:0 1.2rem 1rem}
.lh-title{font-family:var(--ffm);font-size:0.58rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--td);margin-bottom:0.5rem}
.lh-row{display:flex;align-items:center;gap:0.6rem;padding:0.42rem 0.75rem;background:var(--card);border:1px solid var(--border);border-left:3px solid;border-radius:3px;margin-bottom:0.32rem}
.lh-logo{width:16px;height:16px;object-fit:contain;border-radius:2px;flex-shrink:0}
.lh-team{font-weight:700;flex:1;font-size:0.92rem}
.lh-amt{font-family:var(--ffm);font-size:0.78rem;color:var(--green)}
.lh-time{font-family:var(--ffm);font-size:0.56rem;color:var(--tm)}

/* Next bid info */
.next-bid-info{margin:0 1.2rem 0.5rem;background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:0.65rem 0.9rem;display:flex;align-items:center;gap:0.6rem}
.nbi-lbl{font-family:var(--ffm);font-size:0.58rem;color:var(--td);letter-spacing:0.1em;text-transform:uppercase}
.nbi-val{font-family:var(--ffm);font-size:0.9rem;color:var(--green);font-weight:500}
.nbi-pill{padding:0.1rem 0.5rem;border-radius:10px;background:var(--gd);border:1px solid var(--gb);color:var(--green);font-family:var(--ffm);font-size:0.6rem}

/* â”€â”€ BUDGET TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bsum{display:grid;grid-template-columns:repeat(3,1fr);gap:0.48rem;margin-bottom:0.75rem}
.bs{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:0.7rem;text-align:center}
.bs-v{font-size:1.4rem;font-weight:800}
.bs-l{font-family:var(--ffm);font-size:0.52rem;letter-spacing:0.08em;color:var(--td);text-transform:uppercase;margin-top:0.12rem}
.bbar-wrap{height:5px;background:var(--bg3);border-radius:3px;overflow:hidden;margin-bottom:0.5rem}
.bbar{height:100%;border-radius:3px;transition:width 0.5s}
.minn{font-family:var(--ffm);font-size:0.62rem;color:var(--td);text-align:center;margin-bottom:1.1rem;line-height:1.5}
.minn span{color:var(--yellow)}
.minn .ok{color:var(--green)}

/* Squad */
.pg{margin-bottom:0.85rem}
.pg-lbl{font-family:var(--ff);font-size:0.78rem;font-weight:700;letter-spacing:0.2em;text-transform:uppercase;color:var(--td);margin-bottom:0.38rem;padding-bottom:0.22rem;border-bottom:1px solid var(--border)}
.pr{display:flex;align-items:center;gap:0.62rem;padding:0.5rem 0.72rem;background:var(--card);border:1px solid var(--border);border-radius:4px;margin-bottom:0.3rem}
.pr-ph{width:32px;height:32px;border-radius:50%;overflow:hidden;flex-shrink:0;background:var(--bg4)}
.pr-ph img{width:100%;height:100%;object-fit:cover}
.pr-info{flex:1;min-width:0}
.pr-name{font-size:0.92rem;font-weight:700;letter-spacing:0.02em;line-height:1}
.pr-sub{font-family:var(--ffm);font-size:0.56rem;color:var(--td)}
.pr-price{font-family:var(--ffm);font-size:0.7rem;color:var(--green)}
.sq-empty{font-style:italic;color:var(--tm);font-size:0.9rem;padding:0.7rem 0}

/* â”€â”€ STANDINGS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.std-row{display:flex;align-items:center;gap:0.65rem;padding:0.7rem 0.9rem;background:var(--card);border:1px solid var(--border);border-radius:var(--r);margin-bottom:0.48rem;transition:border-color 0.2s}
.std-row.me{border-color:var(--gb);background:var(--gd)}
.std-rank{font-family:var(--ffm);font-size:0.72rem;font-weight:700;color:var(--td);width:22px;text-align:center;flex-shrink:0}
.std-logo{width:38px;height:38px;object-fit:contain;border-radius:4px;flex-shrink:0;background:var(--bg4)}
.std-info{flex:1;min-width:0}
.std-name{font-size:1.05rem;font-weight:800;letter-spacing:0.04em}
.std-sub{font-family:var(--ffm);font-size:0.58rem;color:var(--td);margin-top:0.12rem}
.std-bar-w{height:3px;background:var(--bg3);border-radius:2px;overflow:hidden;margin-top:0.45rem}
.std-bar{height:100%;border-radius:2px;transition:width 0.5s}
.std-bud{text-align:right;flex-shrink:0}
.std-rem{font-size:1.2rem;font-weight:900;color:var(--green)}
.std-sp{font-family:var(--ffm);font-size:0.56rem;color:var(--td);margin-top:0.1rem}
.you-tag{padding:0.1rem 0.4rem;background:var(--gd);border:1px solid var(--gb);border-radius:3px;font-family:var(--ffm);font-size:0.54rem;color:var(--green);flex-shrink:0}

::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="lbox">
    <img class="l-logo" id="lLogo" src="" alt=""/>
    <div class="l-title" id="lTitle">PPL</div>
    <div class="l-sub" id="lSub">Season 7 Â· Manager View</div>
    <label class="l-label">Select Your Team</label>
    <div class="team-btns" id="teamBtns"></div>
    <button class="enter-btn" id="enterBtn" onclick="enter()" disabled>Enter â†’</button>
  </div>
</div>

<!-- APP -->
<div id="appScreen">
  <div class="topbar">
    <div class="tb-l">
      <img class="tb-team-logo" id="tbLogo" src="" alt="" style="display:none"/>
      <div class="tb-name" id="tbName">Team</div>
      <div class="phase-dot pd-idle" id="phDot">IDLE</div>
    </div>
    <div class="tb-r">
      <div class="tb-budget" id="tbBudget">â‚¹0</div>
      <div class="tb-blbl">Remaining</div>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showTab('live')">ğŸ“º Live</div>
    <div class="tab" onclick="showTab('squad')">ğŸ‘¥ My Squad</div>
    <div class="tab" onclick="showTab('standings')">ğŸ† Standings</div>
  </div>

  <!-- LIVE TAB -->
  <div class="tc active" id="tc-live">

    <!-- Current player card -->
    <div class="live-card" id="liveCard">
      <div class="live-card-bg" id="lcBg"></div>
      <div class="live-card-overlay"></div>
      <div class="live-idle" id="lcIdle">âš½ Waiting for next lotâ€¦</div>
      <div class="live-card-content" id="lcContent" style="display:none">
        <div class="lc-photo"><img id="lcPhoto" src="" alt=""/></div>
        <div class="lc-body">
          <div>
            <div class="lc-pos" id="lcPos"></div>
            <div class="lc-name" id="lcName"></div>
            <div class="lc-meta" id="lcMeta"></div>
          </div>
          <div class="lc-bid-row">
            <div>
              <div class="lc-bid-lbl">Current Bid</div>
              <div class="lc-bid-amt" id="lcBid"></div>
            </div>
            <div>
              <div class="lc-bid-lbl">Leading</div>
              <div class="lc-leader" id="lcLeader" style="background:#333;color:#777">â€”</div>
            </div>
          </div>
        </div>
      </div>
      <div class="leading-banner" id="lcBanner" style="display:none">ğŸ† YOUR TEAM LEADING</div>
    </div>

    <!-- Next bid info -->
    <div class="next-bid-info" id="nextBidInfo" style="display:none">
      <span class="nbi-lbl">Next bid</span>
      <span class="nbi-val" id="nbiVal"></span>
      <span class="nbi-pill" id="nbiPill"></span>
      <span style="flex:1"></span>
      <span style="font-family:var(--ffm);font-size:0.56rem;color:var(--tm)" id="nbiNote"></span>
    </div>

    <!-- Bid history -->
    <div class="live-hist" id="liveHist" style="display:none">
      <div class="lh-title">Bid History</div>
      <div id="lhRows"></div>
    </div>

  </div>

  <!-- SQUAD TAB -->
  <div class="tc" id="tc-squad">
    <div class="sec">
      <div class="bsum">
        <div class="bs"><div class="bs-v" id="bsT" style="color:var(--text)">â‚¹0</div><div class="bs-l">Budget</div></div>
        <div class="bs"><div class="bs-v" id="bsS" style="color:var(--yellow)">â‚¹0</div><div class="bs-l">Spent</div></div>
        <div class="bs"><div class="bs-v" id="bsR" style="color:var(--green)">â‚¹0</div><div class="bs-l">Left</div></div>
      </div>
      <div class="bbar-wrap"><div class="bbar" id="bbar"></div></div>
      <div class="minn" id="minNote"></div>
      <div class="sh">
        <div class="st">My Squad</div>
        <div class="sb" id="sqCount" style="color:var(--green)"></div>
      </div>
      <div id="sqList"></div>
    </div>
  </div>

  <!-- STANDINGS TAB -->
  <div class="tc" id="tc-standings">
    <div class="sec">
      <div class="sh">
        <div class="st">Budget Standings</div>
        <div class="sb" id="stMeta" style="color:var(--td)"></div>
      </div>
      <div id="stTable"></div>
    </div>
  </div>

</div>

<script>
const socket = io();
let S = { auctionState:{phase:'idle',currentBid:0,leadingTeam:null,bidHistory:[]}, teams:[], players:[], config:{} };
let myTeamId = null, selId = null, curTab = 'live';

socket.on('stateUpdate', data => {
  S = data;
  if (!myTeamId) renderLogin(); else renderApp();
});

// â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLogin() {
  const { teams, config } = S;
  const ll = document.getElementById('lLogo');
  if (config.leagueLogo) { ll.src=config.leagueLogo; ll.style.display='block'; } else ll.style.display='none';
  document.getElementById('lTitle').textContent = config.leagueName||'PPL';
  document.getElementById('lSub').textContent   = `${config.leagueSeason||'Season 7'} Â· Manager View`;
  document.getElementById('teamBtns').innerHTML = teams.map(t => `
    <button class="tbtn ${selId===t.id?'sel':''}" onclick="selectTeam('${t.id}')">
      ${t.logo?`<img class="tbtn-logo" src="${t.logo}" alt=""/>`:`<div class="tbtn-logo" style="border-radius:50%;background:${t.color};opacity:0.3"></div>`}
      <div style="flex:1;min-width:0">
        <div class="tbtn-name" style="color:${t.color}">${t.name}</div>
        <div class="tbtn-meta">â‚¹${(t.budget-t.spent).toLocaleString()} left Â· ${t.players.length} players</div>
      </div>
    </button>`).join('');
}
function selectTeam(id) {
  selId = id;
  document.getElementById('enterBtn').disabled = false;
  renderLogin();
}
function enter() {
  if (!selId) return;
  myTeamId = selId;
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('appScreen').style.display   = 'flex';
  renderApp();
}

// â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderApp() {
  const team = S.teams.find(t=>t.id===myTeamId);
  if (!team) return;
  const rem   = team.budget - team.spent;
  const phase = S.auctionState.phase;

  // Topbar
  document.getElementById('tbName').textContent = team.name;
  document.getElementById('tbName').style.color = team.color;
  const tl = document.getElementById('tbLogo');
  if (team.logo) { tl.src=team.logo; tl.style.display='block'; } else tl.style.display='none';
  document.getElementById('tbBudget').textContent = `â‚¹${rem.toLocaleString()}`;
  const ph = document.getElementById('phDot');
  ph.textContent = phase.toUpperCase();
  ph.className   = `phase-dot pd-${phase}`;

  if (curTab==='live')      renderLive(team);
  if (curTab==='squad')     renderSquad(team);
  if (curTab==='standings') renderStandings(team);
}

// â”€â”€ LIVE TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLive(team) {
  const { phase, currentPlayer:p, currentBid, leadingTeam, bidHistory } = S.auctionState;
  const isLeading = leadingTeam?.id === myTeamId;
  const isEnded   = !p || phase==='idle'||phase==='sold'||phase==='unsold';

  const lcIdle    = document.getElementById('lcIdle');
  const lcContent = document.getElementById('lcContent');
  const lcBanner  = document.getElementById('lcBanner');
  const nbi       = document.getElementById('nextBidInfo');
  const lhist     = document.getElementById('liveHist');

  if (isEnded) {
    const msgs = {idle:'âš½ Waiting for next lotâ€¦',sold:'âœ… Sold! Next lot comingâ€¦',unsold:'âŒ Unsold. Next lotâ€¦'};
    lcIdle.textContent = msgs[phase]||msgs.idle;
    lcIdle.style.display=''; lcContent.style.display='none';
    lcBanner.style.display='none'; nbi.style.display='none'; lhist.style.display='none';
    document.getElementById('lcBg').style.backgroundImage='';
    return;
  }

  lcIdle.style.display='none'; lcContent.style.display='';
  lcBanner.style.display = isLeading?'block':'none';
  nbi.style.display='flex'; lhist.style.display='block';

  document.getElementById('lcBg').style.backgroundImage = `url(${p.photo})`;
  document.getElementById('lcPhoto').src = p.photo;
  document.getElementById('lcPos').textContent  = p.position;
  document.getElementById('lcName').textContent = p.name;
  document.getElementById('lcMeta').textContent = `Rating: ${p.rating}  Â·  Base: â‚¹${p.basePrice}`;
  document.getElementById('lcBid').textContent  = `â‚¹${currentBid.toLocaleString()}`;

  const ldr = document.getElementById('lcLeader');
  if (leadingTeam) {
    ldr.innerHTML = `${leadingTeam.logo?`<img src="${leadingTeam.logo}" alt=""/>`:''} ${isLeading?'âœ… YOUR TEAM':leadingTeam.name}`;
    ldr.style.background = leadingTeam.color; ldr.style.color='#000';
  } else { ldr.innerHTML='â€”'; ldr.style.background='#333'; ldr.style.color='#777'; }

  // Next bid
  const cfg = S.config;
  const inc = currentBid < (cfg.thresholdBid??200) ? (cfg.highIncrement??20) : (cfg.lowIncrement??10);
  document.getElementById('nbiVal').textContent  = `â‚¹${(currentBid+inc).toLocaleString()}`;
  document.getElementById('nbiPill').textContent = `+â‚¹${inc}`;
  const thresh = cfg.thresholdBid??200;
  document.getElementById('nbiNote').textContent = currentBid < thresh
    ? `Switches to +â‚¹${cfg.lowIncrement} at â‚¹${thresh}`
    : `Using +â‚¹${cfg.lowIncrement}`;

  // History
  document.getElementById('lhRows').innerHTML = (bidHistory||[]).slice(0,8).map((b,i) => `
    <div class="lh-row" style="border-left-color:${b.color}">
      ${b.logo?`<img class="lh-logo" src="${b.logo}" alt=""/>`:`<div class="lh-logo" style="border-radius:50%;background:${b.color};opacity:0.5;width:16px;height:16px"></div>`}
      <span class="lh-team" style="color:${b.color}">${i===0?'ğŸ† ':''}${b.team}${b.team===team.name?' âœ“':''}</span>
      <span class="lh-amt">â‚¹${b.amount.toLocaleString()}</span>
      <span class="lh-time">${timeAgo(b.ts)}</span>
    </div>`).join('');
}

// â”€â”€ SQUAD TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSquad(team) {
  const rem   = team.budget - team.spent;
  const pct   = Math.max(0, (rem/team.budget)*100);
  const need  = Math.max(0, (S.config.minPlayersPerTeam||10) - team.players.length);
  document.getElementById('bsT').textContent = `â‚¹${team.budget.toLocaleString()}`;
  document.getElementById('bsS').textContent = `â‚¹${team.spent.toLocaleString()}`;
  document.getElementById('bsR').textContent = `â‚¹${rem.toLocaleString()}`;
  document.getElementById('bbar').style.width      = pct+'%';
  document.getElementById('bbar').style.background = team.color;
  document.getElementById('sqCount').textContent   = `${team.players.length} / ${S.config.minPlayersPerTeam||10}`;

  const mn = document.getElementById('minNote');
  if (need > 0) {
    const avg = Math.floor(rem/need);
    mn.innerHTML = `Still need <span>${need}</span> more player${need!==1?'s':''} Â· Can average <span>â‚¹${avg.toLocaleString()}</span> each`;
  } else {
    mn.innerHTML = `<span class="ok">âœ… Squad complete â€” ${team.players.length} players signed</span>`;
  }

  const posOrd = ['GK','CB','LB','RB','CDM','CM','CAM','LW','RW','ST'];
  const div = document.getElementById('sqList');
  if (!team.players.length) { div.innerHTML='<div class="sq-empty">No players yet</div>'; return; }
  const g = {};
  team.players.forEach(p=>{ if(!g[p.position]) g[p.position]=[]; g[p.position].push(p); });
  const sorted = Object.entries(g).sort(([a],[b])=>(posOrd.indexOf(a)<0?99:posOrd.indexOf(a))-(posOrd.indexOf(b)<0?99:posOrd.indexOf(b)));
  div.innerHTML = sorted.map(([pos,pls]) => `
    <div class="pg">
      <div class="pg-lbl">${pos} Â· ${pls.length}</div>
      ${pls.map(p=>`<div class="pr">
        <div class="pr-ph"><img src="${p.photo}" alt=""/></div>
        <div class="pr-info">
          <div class="pr-name">${p.name}</div>
          <div class="pr-sub">${p.position} Â· ${p.rating} OVR</div>
        </div>
        <div class="pr-price">â‚¹${(p.soldPrice||0).toLocaleString()}</div>
      </div>`).join('')}
    </div>`).join('');
}

// â”€â”€ STANDINGS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStandings(myTeam) {
  const teams  = S.teams;
  const cfg    = S.config;
  const sorted = [...teams].sort((a,b)=>(b.budget-b.spent)-(a.budget-a.spent));
  const totalSpent = teams.reduce((s,t)=>s+t.spent,0);
  document.getElementById('stMeta').textContent = `${teams.length} teams Â· â‚¹${totalSpent.toLocaleString()} spent total`;
  const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  document.getElementById('stTable').innerHTML = sorted.map((t,i) => {
    const rem  = t.budget - t.spent;
    const pct  = Math.max(0,(rem/t.budget)*100);
    const isMe = t.id === myTeamId;
    const need = Math.max(0,(cfg.minPlayersPerTeam||10)-t.players.length);
    return `<div class="std-row ${isMe?'me':''}">
      <div class="std-rank">${i<3?medals[i]:(i+1)}</div>
      ${t.logo?`<img class="std-logo" src="${t.logo}" alt=""/>`:`<div class="std-logo" style="border-radius:50%;background:${t.color};opacity:0.2;width:38px;height:38px;flex-shrink:0"></div>`}
      <div class="std-info">
        <div style="display:flex;align-items:center;gap:0.45rem">
          <div class="std-name" style="color:${t.color}">${t.name}</div>
          ${isMe?`<div class="you-tag">YOU</div>`:''}
        </div>
        <div class="std-sub">${t.players.length} players Â· ${need>0?`<span style="color:var(--yellow)">Needs ${need} more</span>`:`<span style="color:var(--green)">âœ“ Complete</span>`}</div>
        <div class="std-bar-w"><div class="std-bar" style="width:${pct}%;background:${t.color}"></div></div>
      </div>
      <div class="std-bud">
        <div class="std-rem" style="${isMe?'color:'+t.color:''}">${isMe?'â†’ ':''}â‚¹${rem.toLocaleString()}</div>
        <div class="std-sp">Spent â‚¹${t.spent.toLocaleString()}</div>
      </div>
    </div>`;
  }).join('');
}

// â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showTab(id) {
  curTab = id;
  document.querySelectorAll('.tab').forEach((t,i)=>{
    t.classList.toggle('active',['live','squad','standings'][i]===id);
  });
  document.querySelectorAll('.tc').forEach(c=>c.classList.remove('active'));
  document.getElementById('tc-'+id).classList.add('active');
  const team = S.teams.find(t=>t.id===myTeamId);
  if (team) {
    if(id==='live')      renderLive(team);
    if(id==='squad')     renderSquad(team);
    if(id==='standings') renderStandings(team);
  }
}

function timeAgo(ts){const s=Math.floor((Date.now()-ts)/1000);if(s<60)return`${s}s`;if(s<3600)return`${Math.floor(s/60)}m`;return`${Math.floor(s/3600)}h`;}
</script>
</body>
</html>
