<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PPL S7 â€” Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Barlow+Condensed:wght@400;600;700;800;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<script src="/socket.io/socket.io.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#060610;--bg2:#0b0b1a;--bg3:#101020;--bg4:#181830;--card:#1a1a2e;--border:#252545;
  --green:#00e676;--gd:rgba(0,230,118,0.08);--gb:rgba(0,230,118,0.18);--glow:rgba(0,230,118,0.3);
  --red:#ff4757;--yellow:#ffc107;--blue:#40c4ff;
  --text:#eeeef8;--td:#7070a0;--tm:#333358;
  --ff:'Barlow Condensed',sans-serif;--ffi:Inter,sans-serif;--ffm:'DM Mono',monospace;
  --r:6px;
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:var(--ff);font-size:15px;min-height:100vh}

/* â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#loginScreen{
  min-height:100vh;display:flex;align-items:center;justify-content:center;
  background:radial-gradient(ellipse 60% 70% at 50% 35%,rgba(0,230,118,0.05) 0%,transparent 70%);
}
.login-box{background:var(--card);border:1px solid var(--gb);border-radius:14px;padding:2.5rem;width:90%;max-width:440px;text-align:center;box-shadow:0 20px 80px rgba(0,0,0,0.5)}
.login-logo{width:70px;height:70px;object-fit:contain;margin-bottom:0.8rem;display:none}
.login-title{font-size:2.8rem;font-weight:900;letter-spacing:0.2em;color:var(--green);margin-bottom:0.15rem}
.login-sub{font-family:var(--ffm);font-size:0.62rem;letter-spacing:0.2em;color:var(--td);text-transform:uppercase;margin-bottom:2rem}
.login-section-label{font-family:var(--ffm);font-size:0.6rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--td);display:block;text-align:left;margin-bottom:0.6rem}
.team-btns{display:flex;flex-direction:column;gap:0.5rem;margin-bottom:1rem}
.team-btn{
  display:flex;align-items:center;gap:0.8rem;padding:0.8rem 1rem;
  background:var(--bg3);border:2px solid transparent;border-radius:var(--r);
  cursor:pointer;text-align:left;transition:all 0.15s;
}
.team-btn:hover{border-color:var(--gb);background:var(--bg4)}
.team-btn.sel{border-color:var(--green);background:var(--gd)}
.tb-logo{width:38px;height:38px;object-fit:contain;border-radius:4px;flex-shrink:0;background:var(--bg4)}
.tb-info{flex:1;min-width:0}
.tb-name{font-size:1.1rem;font-weight:800;letter-spacing:0.04em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.tb-meta{font-family:var(--ffm);font-size:0.6rem;color:var(--td);margin-top:0.1rem}
.enter-btn{
  width:100%;padding:0.85rem;background:var(--green);border:none;border-radius:var(--r);
  color:#000;font-family:var(--ff);font-size:1.15rem;font-weight:800;
  letter-spacing:0.1em;text-transform:uppercase;cursor:pointer;transition:all 0.15s;
}
.enter-btn:hover{background:#33ffaa;box-shadow:0 0 20px var(--glow)}
.enter-btn:disabled{opacity:0.3;cursor:not-allowed}

/* â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#appScreen{display:none;min-height:100vh;flex-direction:column}

/* Topbar */
.topbar{
  background:var(--bg2);border-bottom:1px solid var(--border);
  height:56px;padding:0 1.2rem;
  display:flex;align-items:center;justify-content:space-between;
  position:sticky;top:0;z-index:50;
}
.tb-left{display:flex;align-items:center;gap:0.7rem}
.tb-team-logo{width:38px;height:38px;object-fit:contain;border-radius:4px}
.tb-team-name{font-size:1.2rem;font-weight:800;letter-spacing:0.06em}
.tb-phase{padding:0.18rem 0.6rem;border-radius:10px;font-family:var(--ffm);font-size:0.58rem;letter-spacing:0.06em;border:1px solid;text-transform:uppercase}
.tp-idle{border-color:var(--tm);color:var(--tm)}
.tp-live{border-color:var(--green);color:var(--green);background:var(--gd);animation:gp 2s infinite}
.tp-sold{border-color:var(--yellow);color:var(--yellow)}
.tp-unsold{border-color:var(--red);color:var(--red)}
@keyframes gp{0%,100%{box-shadow:none}50%{box-shadow:0 0 8px var(--glow)}}
.tb-right{text-align:right}
.tb-budget-val{font-size:1.4rem;font-weight:800;color:var(--green)}
.tb-budget-lbl{font-family:var(--ffm);font-size:0.55rem;color:var(--td);letter-spacing:0.06em;text-transform:uppercase}

/* Nav tabs */
.nav-tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--border)}
.nav-tab{flex:1;padding:0.65rem;text-align:center;cursor:pointer;font-size:0.92rem;font-weight:700;letter-spacing:0.06em;
  color:var(--td);border-bottom:2px solid transparent;transition:all 0.15s}
.nav-tab.active{color:var(--green);border-bottom-color:var(--green)}
.nav-tab:hover:not(.active){color:var(--text)}
.tab-content{display:none}
.tab-content.active{display:block}

/* Section */
.section{padding:1rem 1.2rem}
.section-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:0.8rem}
.section-title{font-family:var(--ffm);font-size:0.62rem;letter-spacing:0.18em;text-transform:uppercase;color:var(--td)}
.section-badge{font-family:var(--ffm);font-size:0.62rem}

/* â”€â”€ LIVE AUCTION TAB â”€â”€â”€ */
.auction-card{margin:0.8rem 1.2rem;background:var(--card);border:1px solid var(--gb);border-radius:var(--r);overflow:hidden;position:relative}
.ac-grid{display:grid;grid-template-columns:120px 1fr;min-height:148px}
.ac-photo{overflow:hidden;background:var(--bg4)}
.ac-photo img{width:100%;height:100%;object-fit:cover;object-position:top;display:block}
.ac-body{padding:1rem 1.1rem;display:flex;flex-direction:column;justify-content:space-between}
.ac-pos{display:inline-block;padding:0.18rem 0.55rem;background:var(--green);color:#000;font-weight:900;font-size:0.85rem;letter-spacing:0.1em;border-radius:3px;margin-bottom:0.4rem;align-self:flex-start}
.ac-name{font-size:1.6rem;font-weight:900;letter-spacing:0.03em;line-height:1;margin-bottom:0.2rem}
.ac-meta{font-family:var(--ffm);font-size:0.6rem;color:var(--td);margin-bottom:0.7rem}
.ac-bid-row{display:flex;align-items:flex-end;gap:0.8rem}
.ac-bid-lbl{font-family:var(--ffm);font-size:0.56rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--tm);display:block;margin-bottom:0.12rem}
.ac-bid-amt{font-size:2.2rem;font-weight:900;color:var(--green);line-height:1}
.ac-leader{display:flex;align-items:center;gap:0.35rem;padding:0.25rem 0.6rem;border-radius:3px;font-size:0.85rem;font-weight:700;color:#000;margin-top:0.15rem}
.ac-leader img{width:15px;height:15px;object-fit:contain;border-radius:2px}
.ac-idle{padding:2.2rem;text-align:center;color:var(--td);font-style:italic;font-size:0.95rem}
.leading-banner{position:absolute;top:0;right:0;background:var(--green);color:#000;
  padding:0.2rem 0.75rem;font-family:var(--ff);font-size:0.78rem;font-weight:800;letter-spacing:0.1em;text-transform:uppercase;border-radius:0 var(--r) 0 4px}

/* Bid buttons */
.bid-section{margin:0 1.2rem 1rem;background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:1rem}
.bid-sec-title{font-family:var(--ffm);font-size:0.6rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--td);margin-bottom:0.3rem}
.max-bid-note{background:rgba(255,193,7,0.08);border:1px solid rgba(255,193,7,0.2);border-radius:4px;
  padding:0.35rem 0.65rem;font-family:var(--ffm);font-size:0.62rem;color:var(--yellow);margin-bottom:0.7rem}
.preset-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:0.4rem;margin-bottom:0.7rem}
.pbtn{
  padding:0.65rem 0.4rem;background:var(--bg3);border:1px solid var(--border);
  color:var(--text);font-family:var(--ff);font-size:0.95rem;font-weight:700;
  cursor:pointer;border-radius:4px;transition:all 0.15s;text-align:center;
}
.pbtn:hover:not(:disabled){border-color:var(--green);color:var(--green);background:var(--gd)}
.pbtn:active:not(:disabled){transform:scale(0.96)}
.pbtn:disabled{opacity:0.25;cursor:not-allowed}
.pbtn-amt{font-size:1rem;display:block}
.pbtn-sub{font-family:var(--ffm);font-size:0.55rem;opacity:0.55;display:block;margin-top:0.1rem}
.custom-row{display:flex;gap:0.5rem}
.ci{flex:1;background:var(--bg);border:1px solid var(--border);color:var(--text);font-family:var(--ffm);font-size:1rem;padding:0.6rem 0.75rem;outline:none;border-radius:4px;transition:border-color 0.15s}
.ci:focus{border-color:var(--gb)}
.bid-btn{padding:0.62rem 1.2rem;background:var(--green);border:none;color:#000;font-family:var(--ff);font-size:1rem;font-weight:800;letter-spacing:0.08em;text-transform:uppercase;cursor:pointer;border-radius:4px;transition:all 0.15s;white-space:nowrap}
.bid-btn:hover:not(:disabled){background:#33ffaa;box-shadow:0 0 16px var(--glow)}
.bid-btn:disabled{background:var(--tm);cursor:not-allowed}
.bid-status{font-family:var(--ffm);font-size:0.68rem;margin-top:0.5rem;min-height:1em}
.bid-status.err{color:var(--red)}
.bid-status.ok{color:var(--green)}

/* â”€â”€ BUDGET TAB â”€â”€â”€ */
.budget-summary-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:0.5rem;margin-bottom:0.8rem}
.bs{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:0.75rem;text-align:center}
.bs-val{font-family:var(--ff);font-size:1.4rem;font-weight:800}
.bs-lbl{font-family:var(--ffm);font-size:0.54rem;letter-spacing:0.08em;color:var(--td);text-transform:uppercase;margin-top:0.15rem}
.budget-bar-wrap{height:5px;background:var(--bg3);border-radius:3px;overflow:hidden;margin-bottom:0.5rem}
.budget-bar{height:100%;border-radius:3px;transition:width 0.5s}
.min-note{font-family:var(--ffm);font-size:0.62rem;color:var(--td);text-align:center;margin-bottom:1.2rem}
.min-note span{color:var(--yellow)}

/* Squad */
.pos-group{margin-bottom:0.9rem}
.pg-label{font-family:var(--ff);font-size:0.8rem;font-weight:700;letter-spacing:0.2em;text-transform:uppercase;
  color:var(--td);margin-bottom:0.4rem;padding-bottom:0.25rem;border-bottom:1px solid var(--border)}
.pr{display:flex;align-items:center;gap:0.65rem;padding:0.5rem 0.75rem;
  background:var(--card);border:1px solid var(--border);border-radius:4px;margin-bottom:0.32rem}
.pr-photo{width:32px;height:32px;border-radius:50%;overflow:hidden;flex-shrink:0;background:var(--bg4)}
.pr-photo img{width:100%;height:100%;object-fit:cover}
.pr-info{flex:1;min-width:0}
.pr-name{font-size:0.92rem;font-weight:700;letter-spacing:0.02em;line-height:1}
.pr-sub{font-family:var(--ffm);font-size:0.56rem;color:var(--td)}
.pr-price{font-family:var(--ffm);font-size:0.7rem;color:var(--green)}
.squad-empty{font-style:italic;color:var(--tm);font-size:0.9rem;padding:0.8rem 0}

/* â”€â”€ STANDINGS TAB â”€â”€â”€ */
.standings-table{width:100%}
.std-row{
  display:flex;align-items:center;gap:0.7rem;padding:0.7rem 0.9rem;
  background:var(--card);border:1px solid var(--border);
  border-radius:var(--r);margin-bottom:0.5rem;
  transition:border-color 0.2s;
}
.std-row.my-team{border-color:var(--gb);background:var(--gd)}
.std-rank{font-family:var(--ffm);font-size:0.75rem;font-weight:700;color:var(--td);width:22px;text-align:center;flex-shrink:0}
.std-rank.gold{color:#FFD700;font-size:0.9rem}
.std-rank.silver{color:#C0C0C0;font-size:0.88rem}
.std-rank.bronze{color:#CD7F32;font-size:0.85rem}
.std-logo{width:38px;height:38px;object-fit:contain;border-radius:4px;flex-shrink:0;background:var(--bg4)}
.std-info{flex:1;min-width:0}
.std-name{font-size:1.05rem;font-weight:800;letter-spacing:0.04em}
.std-players{font-family:var(--ffm);font-size:0.58rem;color:var(--td);margin-top:0.1rem}
.std-budget-col{text-align:right;flex-shrink:0}
.std-remaining{font-size:1.2rem;font-weight:900;color:var(--green)}
.std-spent{font-family:var(--ffm);font-size:0.58rem;color:var(--td);margin-top:0.1rem}
.std-bar-wrap{height:3px;background:var(--bg3);border-radius:2px;overflow:hidden;margin-top:0.5rem}
.std-bar{height:100%;border-radius:2px;transition:width 0.5s}

/* YOU badge */
.you-badge{padding:0.1rem 0.4rem;background:var(--gd);border:1px solid var(--gb);border-radius:3px;font-family:var(--ffm);font-size:0.56rem;color:var(--green);letter-spacing:0.06em;flex-shrink:0}

::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <img class="login-logo" id="loginLogo" src="" alt=""/>
    <div class="login-title" id="loginTitle">PPL</div>
    <div class="login-sub" id="loginSub">Season 7 Â· Manager Portal</div>
    <label class="login-section-label">Select Your Team</label>
    <div class="team-btns" id="teamBtns"></div>
    <button class="enter-btn" id="enterBtn" onclick="enterAsManager()" disabled>Enter as Manager â†’</button>
  </div>
</div>

<!-- APP -->
<div id="appScreen">
  <div class="topbar">
    <div class="tb-left">
      <img class="tb-team-logo" id="tbLogo" src="" alt="" style="display:none"/>
      <div class="tb-team-name" id="tbName">Team</div>
      <div class="tb-phase tp-idle" id="tbPhase">IDLE</div>
    </div>
    <div class="tb-right">
      <div class="tb-budget-val" id="tbBudget">â‚¹0</div>
      <div class="tb-budget-lbl">Remaining</div>
    </div>
  </div>

  <!-- TABS -->
  <div class="nav-tabs">
    <div class="nav-tab active" onclick="showTab('auction')">âš½ Auction</div>
    <div class="nav-tab" onclick="showTab('budget')">ğŸ’° Budget & Squad</div>
    <div class="nav-tab" onclick="showTab('standings')">ğŸ† Standings</div>
  </div>

  <!-- AUCTION TAB -->
  <div class="tab-content active" id="tab-auction">

    <div class="auction-card" id="aCard">
      <div class="ac-idle" id="acIdle">âš½ Waiting for auction to startâ€¦</div>
      <div class="ac-grid" id="acContent" style="display:none">
        <div class="ac-photo"><img id="acPhoto" src="" alt=""/></div>
        <div class="ac-body">
          <div>
            <div class="ac-pos" id="acPos"></div>
            <div class="ac-name" id="acName"></div>
            <div class="ac-meta" id="acMeta"></div>
          </div>
          <div class="ac-bid-row">
            <div>
              <div class="ac-bid-lbl">Current Bid</div>
              <div class="ac-bid-amt" id="acBid"></div>
            </div>
            <div>
              <div class="ac-bid-lbl">Leading</div>
              <div class="ac-leader" id="acLeader" style="background:#222;color:#666">â€”</div>
            </div>
          </div>
        </div>
      </div>
      <div class="leading-banner" id="leadBanner" style="display:none">ğŸ† LEADING</div>
    </div>

    <div class="bid-section" id="bidSection" style="display:none">
      <div class="bid-sec-title">Place Your Bid</div>
      <div class="max-bid-note" id="maxBidNote" style="display:none"></div>
      <div class="preset-grid" id="presetGrid"></div>
      <div class="custom-row">
        <input class="ci" id="customAmt" type="number" placeholder="Custom â‚¹ amount"/>
        <button class="bid-btn" onclick="placeCustomBid()">Bid</button>
      </div>
      <div class="bid-status" id="bidStatus"></div>
    </div>

  </div>

  <!-- BUDGET TAB -->
  <div class="tab-content" id="tab-budget">
    <div class="section">
      <div class="budget-summary-grid">
        <div class="bs"><div class="bs-val" id="bsTotal" style="color:var(--text)">â‚¹0</div><div class="bs-lbl">Total Budget</div></div>
        <div class="bs"><div class="bs-val" id="bsSpent" style="color:var(--yellow)">â‚¹0</div><div class="bs-lbl">Spent</div></div>
        <div class="bs"><div class="bs-val" id="bsLeft" style="color:var(--green)">â‚¹0</div><div class="bs-lbl">Remaining</div></div>
      </div>
      <div class="budget-bar-wrap"><div class="budget-bar" id="budgetBar"></div></div>
      <div class="min-note" id="minNote"></div>

      <div class="section-hdr">
        <div class="section-title">My Squad</div>
        <div class="section-badge" id="squadCount" style="color:var(--green)"></div>
      </div>
      <div id="squadList"></div>
    </div>
  </div>

  <!-- STANDINGS TAB -->
  <div class="tab-content" id="tab-standings">
    <div class="section">
      <div class="section-hdr">
        <div class="section-title">Budget Standings</div>
        <div class="section-badge" id="standingsMeta" style="color:var(--td)"></div>
      </div>
      <div id="standingsTable"></div>
    </div>
  </div>

</div><!-- /appScreen -->

<script>
const socket = io();
let S = { auctionState:{phase:'idle',currentBid:0,leadingTeam:null}, teams:[], players:[], config:{} };
let myTeamId   = null;
let selectedId = null;
let activeTab  = 'auction';

socket.on('stateUpdate', data => {
  S = data;
  if (!myTeamId) renderLogin(); else renderApp();
});
socket.on('bidError', ({msg}) => showBidStatus(msg, 'err'));

// â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLogin() {
  const { teams, config } = S;
  const ll = document.getElementById('loginLogo');
  if (config.leagueLogo) { ll.src=config.leagueLogo; ll.style.display='block'; } else ll.style.display='none';
  document.getElementById('loginTitle').textContent = config.leagueName || 'PPL';
  document.getElementById('loginSub').textContent   = `${config.leagueSeason||'Season 7'} Â· Manager Portal`;

  document.getElementById('teamBtns').innerHTML = teams.map(t => `
    <button class="team-btn ${selectedId===t.id?'sel':''}" onclick="selectTeam('${t.id}')">
      ${t.logo
        ? `<img class="tb-logo" src="${t.logo}" alt=""/>`
        : `<div class="tb-logo" style="border-radius:50%;background:${t.color};opacity:0.3;width:38px;height:38px"></div>`}
      <div class="tb-info">
        <div class="tb-name" style="color:${t.color}">${t.name}</div>
        <div class="tb-meta">â‚¹${(t.budget-t.spent).toLocaleString()} left Â· ${t.players.length} players</div>
      </div>
    </button>`).join('');
}

function selectTeam(id) {
  selectedId = id;
  document.getElementById('enterBtn').disabled = false;
  renderLogin();
}

function enterAsManager() {
  if (!selectedId) return;
  myTeamId = selectedId;
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('appScreen').style.display   = 'flex';
  renderApp();
}

// â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderApp() {
  const team = S.teams.find(t => t.id === myTeamId);
  if (!team) return;

  const rem  = team.budget - team.spent;
  const pct  = Math.max(0, (rem/team.budget)*100);
  const phase = S.auctionState.phase;

  // Topbar
  document.getElementById('tbName').textContent = team.name;
  document.getElementById('tbName').style.color = team.color;
  const tl = document.getElementById('tbLogo');
  if (team.logo) { tl.src=team.logo; tl.style.display='block'; } else tl.style.display='none';
  document.getElementById('tbBudget').textContent = `â‚¹${rem.toLocaleString()}`;
  const ph = document.getElementById('tbPhase');
  ph.textContent = phase.toUpperCase();
  ph.className = 'tb-phase tp-' + phase;

  // Budget numbers
  document.getElementById('bsTotal').textContent = `â‚¹${team.budget.toLocaleString()}`;
  document.getElementById('bsSpent').textContent = `â‚¹${team.spent.toLocaleString()}`;
  document.getElementById('bsLeft').textContent  = `â‚¹${rem.toLocaleString()}`;
  document.getElementById('budgetBar').style.width      = pct + '%';
  document.getElementById('budgetBar').style.background = team.color;

  const needMore = Math.max(0, (S.config.minPlayersPerTeam||10) - team.players.length);
  const mn = document.getElementById('minNote');
  if (needMore > 0) {
    const avgLeft = needMore > 0 ? Math.floor(rem/needMore) : 0;
    mn.innerHTML = `Still need <span>${needMore}</span> more player${needMore!==1?'s':''} Â· Avg you can spend: <span>â‚¹${avgLeft.toLocaleString()}</span> each`;
  } else {
    mn.innerHTML = `âœ… Squad requirement complete â€” ${team.players.length} players signed`;
    mn.style.color = 'var(--green)';
  }

  if (activeTab === 'auction')   renderAuction(team);
  if (activeTab === 'budget')    renderSquad(team);
  if (activeTab === 'standings') renderStandings(team);
}

function showTab(id) {
  activeTab = id;
  document.querySelectorAll('.nav-tab').forEach((t,i) => {
    const tabs=['auction','budget','standings'];
    t.classList.toggle('active', tabs[i]===id);
  });
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  const team = S.teams.find(t=>t.id===myTeamId);
  if (team) {
    if (id==='auction')   renderAuction(team);
    if (id==='budget')    renderSquad(team);
    if (id==='standings') renderStandings(team);
  }
}

// â”€â”€ AUCTION TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAuction(team) {
  const { phase, currentPlayer:p, currentBid, leadingTeam } = S.auctionState;
  const rem       = team.budget - team.spent;
  const isLeading = leadingTeam?.id === myTeamId;
  const isEnded   = !p || phase==='idle'||phase==='sold'||phase==='unsold';

  if (isEnded) {
    const msg = phase==='sold' ? 'âœ… Sold! Next lot comingâ€¦' : phase==='unsold' ? 'âŒ Unsold. Next lotâ€¦' : 'âš½ Waiting for auction to startâ€¦';
    document.getElementById('acIdle').textContent = msg;
    document.getElementById('acIdle').style.display='';
    document.getElementById('acContent').style.display='none';
    document.getElementById('bidSection').style.display='none';
    document.getElementById('leadBanner').style.display='none';
    return;
  }

  document.getElementById('acIdle').style.display='none';
  document.getElementById('acContent').style.display='';
  document.getElementById('bidSection').style.display='block';
  document.getElementById('leadBanner').style.display = isLeading?'block':'none';

  document.getElementById('acPhoto').src = p.photo;
  document.getElementById('acPos').textContent  = p.position;
  document.getElementById('acName').textContent = p.name;
  document.getElementById('acMeta').textContent = `Rating: ${p.rating}  Â·  Base: â‚¹${p.basePrice}`;
  document.getElementById('acBid').textContent  = `â‚¹${currentBid.toLocaleString()}`;

  const ldr = document.getElementById('acLeader');
  if (leadingTeam) {
    ldr.innerHTML  = `${leadingTeam.logo?`<img src="${leadingTeam.logo}" alt=""/>`:''} ${isLeading?'âœ… You':leadingTeam.name}`;
    ldr.style.background = leadingTeam.color; ldr.style.color='#000';
  } else { ldr.innerHTML='â€”'; ldr.style.background='#222'; ldr.style.color='#666'; }

  // Max bid constraint
  const maxBid  = getMyMaxBid(team);
  const needMore = Math.max(0, (S.config.minPlayersPerTeam||10) - team.players.length - 1);
  const mbn = document.getElementById('maxBidNote');
  if (maxBid < rem) {
    mbn.style.display='block';
    mbn.textContent = `Max you can bid: â‚¹${maxBid.toLocaleString()} â€” must keep budget for ${needMore} more player${needMore!==1?'s':''}`;
  } else mbn.style.display='none';

  // Presets â€” show increments based on current bid
  const cfg    = S.config;
  const inc    = getInc(currentBid, cfg);
  const steps  = [1,2,5,10,20,50];
  document.getElementById('presetGrid').innerHTML = steps.map(m => {
    const amt      = currentBid + inc * m;
    const canAfford = rem >= amt && amt <= maxBid;
    const baseOk    = amt >= p.basePrice;
    const enabled   = canAfford && baseOk;
    return `<button class="pbtn" onclick="placeBid(${amt})" ${enabled?'':'disabled'}>
      <span class="pbtn-amt">â‚¹${amt.toLocaleString()}</span>
      <span class="pbtn-sub">${enabled?'+â‚¹'+(amt-currentBid).toLocaleString():'Max reached'}</span>
    </button>`;
  }).join('');
}

// â”€â”€ SQUAD TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSquad(team) {
  const posOrd = ['GK','CB','LB','RB','CDM','CM','CAM','LW','RW','ST'];
  document.getElementById('squadCount').textContent = `${team.players.length} / ${S.config.minPlayersPerTeam||10}`;
  const div = document.getElementById('squadList');
  if (!team.players.length) { div.innerHTML='<div class="squad-empty">No players yet</div>'; return; }
  const g = {};
  team.players.forEach(p => { if(!g[p.position]) g[p.position]=[]; g[p.position].push(p); });
  const sorted = Object.entries(g).sort(([a],[b])=>(posOrd.indexOf(a)<0?99:posOrd.indexOf(a))-(posOrd.indexOf(b)<0?99:posOrd.indexOf(b)));
  div.innerHTML = sorted.map(([pos,pls]) => `
    <div class="pos-group">
      <div class="pg-label">${pos} Â· ${pls.length}</div>
      ${pls.map(p=>`
        <div class="pr">
          <div class="pr-photo"><img src="${p.photo}" alt=""/></div>
          <div class="pr-info">
            <div class="pr-name">${p.name}</div>
            <div class="pr-sub">${p.position} Â· ${p.rating} OVR</div>
          </div>
          <div class="pr-price">â‚¹${(p.soldPrice||0).toLocaleString()}</div>
        </div>`).join('')}
    </div>`).join('');
}

// â”€â”€ STANDINGS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStandings(myTeam) {
  const teams  = S.teams;
  const config = S.config;
  // Sort by remaining budget (highest = rank 1)
  const sorted = [...teams].sort((a,b) => (b.budget-b.spent) - (a.budget-a.spent));
  const totalSpent = teams.reduce((s,t)=>s+t.spent, 0);

  document.getElementById('standingsMeta').textContent = `${teams.length} teams Â· â‚¹${totalSpent.toLocaleString()} total spent`;

  const rankIcons = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  document.getElementById('standingsTable').innerHTML = sorted.map((t,i) => {
    const rem  = t.budget - t.spent;
    const pct  = Math.max(0, (rem/t.budget)*100);
    const isMe = t.id === myTeamId;
    const needMore = Math.max(0, (config.minPlayersPerTeam||10) - t.players.length);
    return `<div class="std-row ${isMe?'my-team':''}">
      <div class="std-rank ${i===0?'gold':i===1?'silver':i===2?'bronze':''}">${i<3?rankIcons[i]:(i+1)}</div>
      ${t.logo
        ? `<img class="std-logo" src="${t.logo}" alt=""/>`
        : `<div class="std-logo" style="border-radius:50%;background:${t.color};opacity:0.25;flex-shrink:0"></div>`}
      <div class="std-info">
        <div style="display:flex;align-items:center;gap:0.5rem">
          <div class="std-name" style="color:${t.color}">${t.name}</div>
          ${isMe?`<div class="you-badge">YOU</div>`:''}
        </div>
        <div class="std-players" style="margin-top:0.15rem">
          ${t.players.length} player${t.players.length!==1?'s':''} Â· 
          ${needMore>0?`<span style="color:var(--yellow)">Needs ${needMore} more</span>`:`<span style="color:var(--green)">âœ“ Complete</span>`}
        </div>
        <div class="std-bar-wrap"><div class="std-bar" style="width:${pct}%;background:${t.color}"></div></div>
      </div>
      <div class="std-budget-col">
        <div class="std-remaining" style="${isMe?'color:'+t.color:''}">â‚¹${rem.toLocaleString()}</div>
        <div class="std-spent">Spent â‚¹${t.spent.toLocaleString()}</div>
      </div>
    </div>`;
  }).join('');
}

// â”€â”€ BID HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getInc(bid, cfg) {
  return bid < (cfg.thresholdBid??200) ? (cfg.highIncrement??20) : (cfg.lowIncrement??10);
}
function getMyMaxBid(team) {
  const rem      = team.budget - team.spent;
  const stillNeed = Math.max(0, (S.config.minPlayersPerTeam||10) - team.players.length - 1);
  if (stillNeed===0) return rem;
  const pool = S.players
    .filter(p=>p.status==='available'&&p.id!==S.auctionState.currentPlayer?.id)
    .map(p=>p.basePrice).sort((a,b)=>a-b).slice(0,stillNeed);
  while(pool.length<stillNeed) pool.push(pool[pool.length-1]??0);
  return Math.max(0, rem - pool.reduce((s,v)=>s+v,0));
}

function placeBid(amount) {
  socket.emit('placeBid', { teamId:myTeamId, amount });
  showBidStatus(`Submitting â‚¹${amount.toLocaleString()}â€¦`, 'ok');
}
function placeCustomBid() {
  const amt = parseFloat(document.getElementById('customAmt').value);
  if (!amt||isNaN(amt)) return;
  placeBid(amt);
  document.getElementById('customAmt').value='';
}
function showBidStatus(msg, type) {
  const el = document.getElementById('bidStatus');
  el.textContent=msg; el.className='bid-status '+type;
  setTimeout(()=>{ el.textContent=''; el.className='bid-status'; }, 3000);
}
</script>
</body>
</html>
